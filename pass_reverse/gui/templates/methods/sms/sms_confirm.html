<!DOCTYPE html>

<html lang="ko">

<head>
    <meta charset="euc-kr">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="ko-KR">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">

    <title>휴대폰 본인확인 - {{ isp_name }} - 정보입력</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}" media="screen" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reset.css') }}" media="screen" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}" media="screen" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" media="screen" />
    <script src="{{ url_for('static', filename='js/common/jquery.js') }}"></script>
    <script src="{{ url_for('static', filename='js/layerPopup.js') }}"></script>
    <script src="{{ url_for('static', filename='js/style.js') }}"></script>


    <script type="text/javascript">
        let overClickCheck = false;
        let timerInterval = null;

        function fnRequestAjax(url, data, successCallback, failCallback) {
            $.ajax({
                url: url,
                method: 'POST',
                data: data,
                success: function (response) {
                    if (successCallback) successCallback(response);
                },
                error: function () {
                    if (failCallback) failCallback();
                }
            });
        }

        function onMovePage(url) {
            if (url) location.href = url;
        }

        function timerOn(seconds) {
            let remaining = seconds;
            updateTimerDisplay(remaining);

            timerInterval = setInterval(function () {
                remaining--;
                updateTimerDisplay(remaining);

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    messageLayerOpen("시간 초과", "인증 시간이 초과되었습니다. 다시 시도해 주세요.", $("#btnSubmit"));
                }
            }, 1000);
        }

        function timerReset(seconds) {
            if (timerInterval) clearInterval(timerInterval);
            timerOn(seconds);
        }

        function updateTimerDisplay(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            $("#timer").text(min + ":" + (sec < 10 ? "0" : "") + sec);
        }

        $(function () {
            $('body').on('click', '#btnSubmit', function () {
                if (overClickCheck) return false;
                if (!checkValueLayer($("#certCode"), "인증번호를 입력해 주세요.")) return false;

                function confirmSuccess(data) {
                    if (data.code === 'SUCCESS') {
                        onMovePage(data.move_page);
                    } else if (data.code === 'RETRY') {
                        messageLayerOpen(data.message || "인증번호가 올바르지 않습니다.<br>다시 입력해주세요", data
                            .sub_message || "", $("#btnSubmit"));
                        overClickCheck = false;
                    } else {
                        messageLayerOpen("인증 실패", data.message || "인증에 실패했습니다.", $("#btnSubmit"));
                        overClickCheck = false;
                    }
                }

                function confirmFail() {
                    messageLayerOpen("오류", "요청 중 오류가 발생했습니다.", $("#btnSubmit"));
                    overClickCheck = false;
                }

                overClickCheck = true;
                fnRequestAjax("{{ url_for('sms_confirm_proc') }}", $("#frm").serialize(), confirmSuccess, confirmFail);
            });

            $('body').on('click', '#btnResend', function () {
                if (overClickCheck) return false;

                function smsResendSuccess(data) {
                    if (data.code === 'SUCCESS') {
                        $("#certCode").val("");
                        messageLayerOpen("알림", data.message || "인증번호가 재발송되었습니다.", $("#certCode"));
                        timerReset(180);
                    } else {
                        messageLayerOpen("알림", data.message || "재발송에 실패했습니다.", $("#btnResend"));
                    }
                    overClickCheck = false;
                }

                function smsResendFail() {
                    messageLayerOpen("인증번호 재발송에 실패했습니다.", "잠시 후 다시 시도해 주세요.", $("#btnResend"));
                    overClickCheck = false;
                }

                overClickCheck = true;
                fnRequestAjax("{{ url_for('sms_resend_proc') }}", "", smsResendSuccess, smsResendFail);
            });

            $('body').on('click', '#resetTimer', function () {
                timerReset(180);
            });
        });

        $(window).on('load', function () {
            timerOn(180);
        });
    </script>
</head>

<body>
    <div class="" id="container">

        <header id="header" class="pass_head">
            <h1 class="logo">
                <img src="https://nice.checkplus.co.kr/images/mobileCertV2/logo_pass.svg?ver=1767676388823" alt="PASS">
            </h1>


            <em>인증을 넘어<br>일상으로 PASS</em>

        </header>


        <section class="sc_content certWay_content">
            <form name="frm" id="frm" method="post" autocomplete="off" onsubmit="return false">
                <div class="inner">
                    <h2><strong>보내드린 인증번호 6자리</strong>를<br>입력해 주세요</h2>
                    <div class="group_smsway">
                        <div class="code_area">
                            <div class="step_box">
                                <input type="text" name="certCode" id="certCode" placeholder="인증번호" maxlength="6"
                                    data-enc="on">
                                <label for="certCode" class="blind">인증번호</label>
                            </div>

                            <div class="btn_box">
                                <button type="button" id="btnSubmit" class="btn_check on">확인</button>
                            </div>
                        </div>
                        <div class="time_box">
                            <span class="time_lt">
                                <i class="clock" aria-hidden="true"></i>
                                <span class="count_txt">남은시간</span>
                                <span class="count" id="timer"></span>
                            </span>
                            <button type="button" id="resetTimer" class="btn_delay">시간연장</button>
                        </div>
                    </div>
                </div>
            </form>
        </section>


        <div id="messageLayer" class="popup_wrap">
            <div class="dim"></div>
            <div class="group_popup type2">
                <div class="inner">
                    <div class="popup_head">
                        <h3></h3>
                    </div>
                    <div class="popup_content">
                        <p class="code_txt"></p>
                    </div>
                    <button type="button" class="btn_close btnLayerClose">확인</button>
                </div>
            </div>
        </div>

        <footer id="footer" class="nice_footer">
            <div class="copyright">
                <div class="copyrightInner">
                    <a href="https://github.com/Imp1ex/Pass-Reverse/blob/main/NICE.md" target="_blank"
                        class="footerAgreePop" title="새창 열림"><span class="bold partition">NICE평가정보 공식 항목들</span></a>
                    <a href="https://github.com/Imp1ex/Pass-Reverse" target="_blank" class="footerAgreePop"
                        title="새창 열림"><span class="partition">오픈소스</span></a>
                    <p>해당 페이지는 공식 PASS 인증 페이지가 아닙니다</p>
                </div>
                <div class="logoBox">
                    <div class="footer_logo">
                        <img src="https://nice.checkplus.co.kr/images/cert/copyright_small.gif" alt="NICE평가정보">
                    </div>
                </div>
            </div>
        </footer>
    </div>


</body>

</html>